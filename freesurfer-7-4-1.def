Bootstrap: docker
From: freesurfer/freesurfer:7.4.1

%help
    This container provides FreeSurfer for neuroimaging processing. version 7.4.1

%setup
        cat <<END >${APPTAINER_ROOTFS}/usr/local/freesurfer/.license
<<<INSERT PASTE LICENCE HERE >>>
%post
    cat <<EOF > /etc/yum.repos.d/CentOS-Base.repo
[baseos]
name=CentOS Stream 8 - BaseOS
baseurl=http://vault.centos.org/8-stream/BaseOS/x86_64/os/
gpgcheck=0
enabled=1

[appstream]
name=CentOS Stream 8 - AppStream
baseurl=http://vault.centos.org/8-stream/AppStream/x86_64/os/
gpgcheck=0
enabled=1
[extras]
name=CentOS Stream 8 - Extras
baseurl=http://vault.centos.org/8-stream/extras/x86_64/os/
gpgcheck=0
enabled=1

[extras-common]
name=CentOS Stream 8 - Extras common packages
baseurl=http://vault.centos.org/8-stream/extras/x86_64/extras-common/
gpgcheck=0
enabled=1


EOF

    dnf clean all
    dnf makecache

    dnf -y install epel-release
    dnf remove -y mesa*  # Remove all mesa/GL to start clean
    dnf -y install \
        bc \
        libgomp \
        libXmu \
        libXt \
        tcsh \
        perl \
        qt5-qtdeclarative \
        qt5-qtbase-gui \
        qt5-qtx11extras \
        libXScrnSaver \
        libXft \
        libjpeg-turbo \
        epel-release
    dnf install -y mesa-dri-drivers mesa-libGL mesa-libEGL mesa-libGLU
    dnf clean all

    # Version FreeSurfer
    export FREESURFER_VERSION=7.4.1
%runscript
    exec "$@"
